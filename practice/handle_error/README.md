# 故障处理


- 验证错误

最难修复的问题是无法重现的问题，只要可以重现，就有修复的可能。

- 恢复服务

最小化故障的影响，降低损失。
摘机：摘除有问题的机器。这种操作的应用场景是，当提供服务的多台机器中，有部分机器出现问题时，可以这样操作。这就要求我们，对于线上运行的服务，必须保障有多台机器运行相同的服务，多台机器间没有依赖关系。其中一台或者几台被摘除不会影响到其他机器。
回滚：所谓回滚就是恢复到操作之前的状态。这种操作的应用场景是，当进行了上线或者软件配置修改后，出现了问题。
重启：当你的服务运行一段时间，突然出现了异常。如进程占用了cpu 100%。你可以通过重启的方式来解决。重启的过程就是一个资源释放和重新分配的过程。
降级：当你的网站的访问量超出了你服务器的负载时，网站就会出现问题。这个时候，就需要保证主要功能可用。把损失降到最低。

- 保留现场

系统内部日志：如果有良好的日志记录，那就可以记录系统运行过程中出现的一些异常。良好的日志系统，也是我们在选择开源软件时的重要标准。
系统外部监控：在系统中，总有一些地方是你不方便或者没权增加日志记录的。如，咱们在调用第三方服务的时候，肯定你也不方便在第三方服务中添加日志。这个时候，我们就需要增加对第三方服务的监控和日志记录。能时刻知道第三方服务是否可用。
保留运行状态：这个就是案发现场的保留。比如，你发现一个进程占用cpu 100%。你为了解决问题，贸然的重启进程，就是破坏了现场。
保留现场和恢复服务并没有一个明确的先后关系。他们共同是问题排查的基础。恢复了服务，你才可用安心的进行问题排查。保留了现场，你才有问题排查的数据来源。有时候，保留现场和恢复服务会有冲突。如，你就一台机器提供服务，这台机器上出现了问题，这个时候要如何处理呢？这个时候建议最短的时间备份现场，然后尽快的恢复服务。如，一个进程占用cpu 100%，那你就可以用 gcore 把进程生成core文件，然后重启进程。

- 隐藏错误
例如Web开发，常见Nginx502或者500的默认错误页，这些错误页不仅丑陋，而且容易泄露一些敏感和不应暴露的信息，例如nginx版本号，路径信息等